<!-- <?xml version="1.0" encoding="UTF-8"?> -->
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>


<!-- @Alias("att")  -->
<mapper namespace="com.my.cab.dao.AttendanceDAO">

	<select id="attHistoryListCall" resultType="att">
	SELECT attendance_idx, att_time, leave_time, att_result, work_day
	FROM attendance
	WHERE emp_no = #{emp_no}
	</select>
	
	<select id="getAttDetail" resultType="att">
	SELECT a.attendance_idx, e.emp_name, a.emp_no, a.att_time, a.leave_time, a.att_result, a.work_day
	FROM attendance a
	JOIN employee e ON a.emp_no = e.emp_no
	WHERE a.attendance_idx = #{attendance_idx}
	</select>
	
	<insert id="attEditApply" parameterType="att"> 
	INSERT INTO attendance_management (attendance_management, att_applicant, att_previous_attresult, att_modify_attresult, att_reason)
	VALUES (#{attendance_management},${att_applicant},#{att_previous_attresult},#{att_modify_attresult},#{att_reason})
	</insert>
	
	<select id="attEditList" resultType="att">
	SELECT att_management_idx, att_applicant_date, att_apply_status
	FROM attendance_management
	WHERE att_applicant = #{param3}
	ORDER BY att_management_idx DESC
	LIMIT #{param2}, 10
	</select>
	
	<select id="allCount" resultType="Integer">
		SELECT CEIL(COUNT(att_management_idx)
		/ #{param1}) AS pages
		FROM attendance_management
		WHERE att_applicant = #{param2}
	</select>
	
	<select id="attEditListDetail" resultType="att">
	SELECT 
	a.att_applicant, e.emp_name, at.work_day, 
	at.att_time, at.leave_time, a.att_previous_attresult, 
	a.att_modify_attresult, a.att_reason, a.att_modify_reject, 
	a.att_modifier, a.att_modify_date
	FROM attendance_management a
	JOIN employee e ON a.att_applicant = e.emp_no
	JOIN attendance at ON a.attendance_management = at.attendance_idx
	WHERE a.att_management_idx = #{att_management_idx}
	</select>
	
	

</mapper>